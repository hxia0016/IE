<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garbage Detection - GreenerLife </title>
    <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}"/>

    <!-- fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    <link href="{% static 'new_template/css/css2.css'%}" rel="stylesheet">


    <link rel="stylesheet" href="{% static 'new_template/css/bootstrap.min.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/animate.min.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/custom-animate.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/all.min.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/jarallax.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/jquery.magnific-popup.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/nouislider.min.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/nouislider.pips.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/odometer.min.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/swiper.min.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/style.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/tiny-slider.min.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/stylesheet.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/owl.carousel.min.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/owl.theme.default.min.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/twentytwenty.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/jquery.bxslider.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/bootstrap-select.min.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/vegas.min.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/jquery-ui.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/timePicker.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/component.css'%}">

    <!-- template styles -->
    <link rel="stylesheet" href="{% static 'new_template/css/izeetak.css'%}">
    <link rel="stylesheet" href="{% static 'new_template/css/izeetak-responsive.css'%}">
</head>

<body>

<div class="preloader">
    <img class="preloader__image" width="60" src="{% static 'images/logo_1.png'%}" alt="">
</div>
<!-- /.preloader -->
<div class="page-wrapper">
    <header class="main-header clearfix">
        <nav class="main-menu clearfix">
            <div class="main-menu-wrapper clearfix">
                <div class="main-menu-wrapper-inner clearfix">
                    <div class="main-menu-wrapper__left clearfix">
                        <div class="main-menu-wrapper__logo">
                            <a href="{% url 'index' %}"><img src="{% static 'images/logo_1.png'%}" alt=""></a>
                        </div>
                        <div class="main-menu-wrapper__main-menu">
                            <a href="#" class="mobile-nav__toggler"><i class="fa fa-bars"></i></a>
                            <ul class="main-menu__list">
                                <li class="current"><a href="{% url 'index' %}">Home</a></li>
                                <li class="current"><a href="{% url 'garbage_video' %}">Waste Classification </a></li>
                                <li class="current"><a href="{% url 'edu' %}">Video Game </a></li>
                                <li class="current"><a href="{% url 'e_waste_classification' %}">E-waste</a></li>
                                <li class="current"><a href="{% url 'clothing' %}">Clothing</a></li>
                                <li class="current"><a href="{% url 'food' %}">Food Waste</a></li>

                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="stricky-header stricked-menu main-menu">
        <div class="sticky-header__content"></div><!-- /.sticky-header__content -->
    </div><!-- /.stricky-header -->

    <!--Page Header Start-->
    <section class="page-header">
        <div class="page-header-bg" style="background-image: url(/static/images/recycle.png)">
        </div>
        <div class="page-header-bg-overly"></div>
        <div class="page-header-shape wow slideInRight" data-wow-delay="100ms" data-wow-duration="2500ms"
             style="background-image: url(/static/new_template/image/page-header-shape.png)"></div>
        <div class="container">
            <div class="page-header__inner">
                <ul class="thm-breadcrumb list-unstyled">
                    <li><a href="{% url 'index' %}">Home</a></li>
                    <li><span>/</span></li>
                    <li>Waste Classification </li>
                </ul>
            </div>
        </div>
    </section>
    <!--Page Header End-->

    <!--Service Details Start-->
    <section class="service-details">
        <div class="container">
            <div class="row">
                <div class="col-xl-8 col-lg-7">
                    <div class="service-details__right">
                        <div class="service-details__content">
                            <h3 class="service-details__title"> Let's use a camera to quickly sort garbage</h3>
                        </div>
                        <div class="service-details__benefits">
                            <div class="row">
                                <div class="service-details__benefits-text">
                                          <div class="messgae" id="message" hidden="hidden" >
                                              <video name="video" autoplay="true" id="videoElement"></video>
                                              <canvas id="canvas" width="640" height="480"></canvas>
                                              <canvas id="canvas1" width="640" height="480"></canvas>
                                          </div>
                                          <div align="center"><img src="" id="image1"></div>

                                    </div>
                            </div>
                        </div>
                    </div>
                    <div class="service-details__text">
                            <h3 class="service-details__benefits-title">Upload a picture to get classification</h3>
                            <p class="service-details__text">If the camera is not working, please try to use upload image function.
                            Just upload the garbage image and the result will show in that picture.</p>
                            <div class="service-details__benefits">
                            <input type="file" class="inputfile-6" id="file" accept="image/*">
                            <div align="center">
                                <p id="pic_recycle"></p>
                                <img src="" id="pic" style="width: 50%">
                            </div>
                                </div>
                    </div>
                    <div class="service-details__text">
                            <div class="service-details__content">
                            <h3 class="service-details__title"> Why we need garbage classification?</h3>
                            <p class="service-details__text">Data shows 84 - 96% of kerbside recycling is recycled, and the
                                remaining 4 -
                                16% that goes to landfill is primarily a result of the wrong thing going in the wrong
                                bin.</p>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4 col-lg-5">
                    <div class="service-details__sidebar">

                        <div class="service-details__sidebar-service">
                            <h4 class="service-details__sidebar-title">How to use classify garbage function?</h4>

                                <p><ol>
                                           <li>Put the garbage in front of webcam</li>
                                            <li>Keep the garbage occupy the main area of video</li>
                                            <li>keep holding that garbage until the information won't change</li>
                                            <li>The classification information will show in the video</li>
                                        </ol></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--Service Details End-->
    <style>
        #video {
            width: 640px;
            height: 480px;
        }
    </style>
     <script>


     var video = document.querySelector("#videoElement");
     var image = document.querySelector("#image1");
    // chunks = [];
    if (navigator.mediaDevices.getUserMedia) {
      navigator.mediaDevices.getUserMedia({
        video: true
      })
        .then(function (stream) {
            video.srcObject = stream;
        })
        .catch(function (err0r) {
          console.log("Something went wrong!");
        });
    }

    // 获取房间名
    const roomName = "garbage";
    // 根据roomName拼接websocket请求地址，建立长连接
    //  请求url地址为/ws/chat/<room_name>/
    const wss_protocol = (window.location.protocol == 'https:') ? 'wss://' : 'ws://';
    const chatSocket = new WebSocket(
        wss_protocol + window.location.host + '/ws/chat/' + roomName + '/'
    );

    // 建立websocket连接时触发此方法，展示欢迎提示
    chatSocket.onopen = function (e) {
        console.log("success");
    }

    // 从后台接收到数据时触发此方法
    // 接收到后台数据后对其解析，并加入到聊天记录chat-log
    chatSocket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        image.src = data.message;
    };

    // websocket连接断开时触发此方法
    chatSocket.onclose = function (e) {
        console.error('Chat socket closed unexpectedly');
    };


    function takephoto() {
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
        let image_data_url = canvas.toDataURL('image/jpeg');
        // data url of the image
        if(chatSocket["readyState"]==1) {
            chatSocket.send(JSON.stringify({
                'message': image_data_url
            }));
        }

    }
    setInterval("takephoto()",250);

     // 图片预览
        document.querySelector('#file').addEventListener('change', (ev) => {
            let reader = new FileReader();
            reader.addEventListener('load', (e) => {
                $.post("/garbageClassification/",{data:e.target.result,csrfmiddlewaretoken: '{{ csrf_token }}'}, function (data, status) {
                    const return_message = JSON.parse(data);
                    document.querySelector('#pic_recycle').innerHTML = return_message.text
                    // console.log(return_message.text)
                    $('#pic').attr("src", return_message.message)
                    $("#pic").show();
                });
            });
            reader.readAsDataURL(ev.target.files[0]);
        });

</script>

    <!--Site Footer One Start-->
    <footer class="site-footer">
	<div class="site-footer__top">
		<div class="container">
			<div class="site-footer__top-inner" style="padding: 20px">
				<div class="site-footer-map"
					 style="background-image: url(/static/new_template/image/site-footer-mape.png)"></div>
				<div class="row">
					<div class="col-xl-3 col-lg-6 col-md-6 wow fadeInUp" data-wow-delay="200ms">
						<div class="footer-widget__column footer-widget__links clearfix">
							<h3 class="footer-widget__title">Links</h3>
							<li><a href="{% url 'index' %}">Home</a></li>
                            <li><a href="{% url 'garbage_video' %}">Waste Classification </a></li>
							<li><a href="{% url 'edu' %}">Video Game </a></li>
							<li><a href="{% url 'e_waste_classification' %}">E-waste</a></li>
							<li><a href="{% url 'clothing' %}">Clothing</a></li>
                            <li><a href="{% url 'food' %}">Food Waste</a></li>


						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="site-footer__bottom">
		<div class="site-footer__bottom-container">
			<div class="container">
				<div class="row">
					<div class="col-xl-12">
						<div class="site-footer__bottom-inner">
							<div class="site-footer__bottom-left">
								<p class="site-footer__bottom-text">Copyright &copy; 2021.GreenerLife All rights
									reserved.</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</footer>
    <!--Site Footer One End-->


</div><!-- /.page-wrapper -->


<div class="mobile-nav__wrapper">
    <div class="mobile-nav__overlay mobile-nav__toggler"></div>
    <!-- /.mobile-nav__overlay -->
    <div class="mobile-nav__content">
        <span class="mobile-nav__close mobile-nav__toggler"><i class="fa fa-times"></i></span>

        <div class="logo-box">
            <a href="" aria-label="logo image"><img src="{% static 'images/logo_1.png'%}" width="155"
                                                              alt=""></a>
        </div>
        <!-- /.logo-box -->
        <div class="mobile-nav__container"></div>
        <!-- /.mobile-nav__container -->

        <ul class="mobile-nav__contact list-unstyled">

        </ul><!-- /.mobile-nav__contact -->
        <div class="mobile-nav__top">
        </div><!-- /.mobile-nav__top -->


    </div>
    <!-- /.mobile-nav__content -->
</div>
<!-- /.mobile-nav__wrapper -->

<!-- /.search-popup -->

<a href="#" data-target="html" class="scroll-to-target scroll-to-top"><i class="fa fa-angle-up"></i></a>

<script src="{% static 'new_template/js/jquery-3.6.0.min.js'%}"></script>
<script src="{% static 'new_template/js/bootstrap.bundle.min.js'%}"></script>
<script src="{% static 'new_template/js/jarallax.min.js'%}"></script>
<script src="{% static 'new_template/js/jquery.ajaxchimp.min.js'%}"></script>
<script src="{% static 'new_template/js/jquery.appear.min.js'%}"></script>
<script src="{% static 'new_template/js/jquery.circle-progress.min.js'%}"></script>
<script src="{% static 'new_template/js/jquery.magnific-popup.min.js'%}"></script>
<script src="{% static 'new_template/js/jquery.validate.min.js'%}"></script>
<script src="{% static 'new_template/js/nouislider.min.js'%}"></script>
<script src="{% static 'new_template/js/odometer.min.js'%}"></script>
<script src="{% static 'new_template/js/swiper.min.js'%}"></script>
<script src="{% static 'new_template/js/tiny-slider.min.js'%}"></script>
<script src="{% static 'new_template/js/wNumb.min.js'%}"></script>
<script src="{% static 'new_template/js/wow.js'%}"></script>
<script src="{% static 'new_template/js/isotope.js'%}"></script>
<script src="{% static 'new_template/js/countdown.min.js'%}"></script>
<script src="{% static 'new_template/js/owl.carousel.min.js'%}"></script>
<script src="{% static 'new_template/js/twentytwenty.js'%}"></script>
<script src="{% static 'new_template/js/jquery.event.move.js'%}"></script>
<script src="{% static 'new_template/js/jquery.bxslider.min.js'%}"></script>
<script src="{% static 'new_template/js/bootstrap-select.min.js'%}"></script>
<script src="{% static 'new_template/js/vegas.min.js'%}"></script>
<script src="{% static 'new_template/js/jquery-ui.js'%}"></script>
<script src="{% static 'new_template/js/timePicker.js'%}"></script>
<script src="{% static 'new_template/js/particles.min.js'%}"></script>
<script src="{% static 'new_template/js/particles-config.js'%}"></script>


<!-- template js -->
<script src="{% static 'new_template/js/izeetak.js'%}"></script>


</body>

</html>